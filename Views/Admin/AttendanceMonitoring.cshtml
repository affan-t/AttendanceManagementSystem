@model IEnumerable<AttendanceManagementSystem.Models.Attendance>

@{
    ViewData["Title"] = "Attendance Monitoring";
}

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="page-title">Attendance Monitoring</h1>
        <p class="page-subtitle mb-0">View and filter attendance records</p>
    </div>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-header">
        <h6 class="mb-0"><i class="bi bi-funnel me-2"></i>Filters</h6>
    </div>
    <div class="card-body">
        <form method="get" asp-action="AttendanceMonitoring">
            <div class="row g-3">
                <div class="col-md-2">
                    <label class="form-label">Course</label>
                    <select name="courseId" class="form-select form-select-sm">
                        <option value="">All Courses</option>
                        @foreach (var course in ViewBag.Courses as IEnumerable<AttendanceManagementSystem.Models.Course>)
                        {
                            <option value="@course.Id" selected="@(ViewBag.SelectedCourseId != null && (int)ViewBag.SelectedCourseId == course.Id)">
                                @course.Code
                            </option>
                        }
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Batch</label>
                    <select name="batchId" class="form-select form-select-sm">
                        <option value="">All Batches</option>
                        @foreach (var batch in ViewBag.Batches as IEnumerable<AttendanceManagementSystem.Models.Batch>)
                        {
                            <option value="@batch.Id" selected="@(ViewBag.SelectedBatchId != null && (int)ViewBag.SelectedBatchId == batch.Id)">
                                @batch.Name
                            </option>
                        }
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Section</label>
                    <select name="sectionId" class="form-select form-select-sm">
                        <option value="">All Sections</option>
                        @foreach (var sec in ViewBag.Sections as IEnumerable<AttendanceManagementSystem.Models.Section>)
                        {
                            <option value="@sec.Id" selected="@(ViewBag.SelectedSectionId != null && (int)ViewBag.SelectedSectionId == sec.Id)">
                                @sec.Name
                            </option>
                        }
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">From Date</label>
                    <input type="date" name="fromDate" class="form-control form-control-sm" value="@(ViewBag.FromDate?.ToString("yyyy-MM-dd"))" />
                </div>
                <div class="col-md-2">
                    <label class="form-label">To Date</label>
                    <input type="date" name="toDate" class="form-control form-control-sm" value="@(ViewBag.ToDate?.ToString("yyyy-MM-dd"))" />
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary btn-sm w-100">
                        <i class="bi bi-search me-1"></i>Filter
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Stats -->
<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="stat-card-value">@Model.Count()</div>
                    <div class="stat-card-label">Total Records</div>
                </div>
                <div class="stat-card-icon primary"><i class="bi bi-clipboard-data"></i></div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="stat-card-value text-success">@Model.Count(a => a.IsPresent)</div>
                    <div class="stat-card-label">Present</div>
                </div>
                <div class="stat-card-icon success"><i class="bi bi-check-circle"></i></div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="stat-card">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <div class="stat-card-value text-danger">@Model.Count(a => !a.IsPresent)</div>
                    <div class="stat-card-label">Absent</div>
                </div>
                <div class="stat-card-icon danger"><i class="bi bi-x-circle"></i></div>
            </div>
        </div>
    </div>
</div>

<!-- Table -->
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h6 class="mb-0">Attendance Records</h6>
        <span class="badge bg-secondary">Latest 500</span>
    </div>
    @if (!Model.Any())
    {
        <div class="card-body">
            <div class="empty-state py-4">
                <div class="empty-state-icon"><i class="bi bi-inbox"></i></div>
                <h6 class="empty-state-title">No Records Found</h6>
                <p class="empty-state-text mb-0">Try adjusting the filters above.</p>
            </div>
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table mb-0">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Student</th>
                        <th>Roll No</th>
                        <th>Course</th>
                        <th>Teacher</th>
                        <th>Batch</th>
                        <th>Section</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var record in Model)
                    {
                        <tr>
                            <td class="text-muted">@record.AttendanceDate.ToString("MMM dd, yyyy")</td>
                            <td class="fw-medium">@record.Student?.Name</td>
                            <td><span class="badge badge-secondary">@record.Student?.RollNo</span></td>
                            <td><span class="badge badge-primary">@record.CourseAllocation?.Course?.Code</span></td>
                            <td>@record.CourseAllocation?.Teacher?.Name</td>
                            <td>@record.CourseAllocation?.Batch?.Name</td>
                            <td>@record.CourseAllocation?.Section?.Name</td>
                            <td>
                                @if (record.IsPresent)
                                {
                                    <span class="badge badge-success"><i class="bi bi-check me-1"></i>Present</span>
                                }
                                else
                                {
                                    <span class="badge badge-danger"><i class="bi bi-x me-1"></i>Absent</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>
